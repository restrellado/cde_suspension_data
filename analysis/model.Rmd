---
title: "R Notebook"
output: html_notebook
---

# Load data 

```{r load raw data}
source(here::here("src", "clean_data.R"))
```

# Clean data

Suspension counts are unduplicated counts of students suspended. This means that if a student got supsended three times, they would only be counted once in the dataset. 

```{r filter total}
# Cleaning drops 344,909 rows 
total_sus <- school_sus %>% 
  filter(
    # Total counts across all subgroups 
    reporting_category == "Total", 
    # Drop rows where enrollment is not reported because of small n size
    !is.na(cumulative_enrollment)) 
```

```{r make 14 digit code}
total_sus <- total_sus %>% 
  mutate(cds_code = paste0(county_code, district_code, school_code))
```

# Join suspension data set with school database 

```{r}
# Pick columns 
raw_schools <- raw_schools %>%  
  select(cds_code, status_type, charter, funding_type, doc_type, soc_type)
```

About 2 percent of the records in the total suspension dataset don't have a match in the California school database. 234 of the 252 of the non-matching records have a school code of "0000001". 

```{r}
# Compare to 6396 FALSE and 11728 TRUE
table(total_sus$cds_code %in% raw_schools$cds_code)
prop.table(table(total_sus$cds_code %in% raw_schools$cds_code))
```

```{r}
total_sus$match_status <- total_sus$cds_code %in% raw_schools$cds_code
```

```{r}
total_sus <- left_join(total_sus, raw_schools, by = "cds_code")
```

TODO: Explore and validate total_sus


# Exploratory Data Analysis 

Plot student enrollment vs students suspended at least once. 

```{r plot student enrollment and students suspended}
ggplot(data = total_sus, 
       aes(x = cumulative_enrollment, 
           y = unduplicated_count_of_students_suspended_total)) +
  geom_point(alpha = .5) +
  geom_smooth(method = "lm") + 
  labs(y = "Students suspended")
```

```{r fit model 1}
fit <- lm(unduplicated_count_of_students_suspended_total ~ cumulative_enrollment, 
          data = total_sus)

summary(fit)
```

# About the Outliers

```{r}

```
